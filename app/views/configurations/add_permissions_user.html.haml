.wrapper.top
  .grid_8
    = form_tag(create_permission_user_configurations_path, method: "post") do
      .grid_4.first
        .panel
          .clearfix
            =label_tag :user_id
            =select_tag :user_id, options_from_collection_for_select(@users.sort_by(&:name), :id, :name), {:include_blank => ''}
          .clearfix
            =hidden_field_tag :permissions
          .clearfix
            %button.button{:type => "submit"}
              = t :save
      .grid_2
        .panel
          =label_tag :permissions
          %table
            -@count = 0
            -@permissions.each do |permission|
              %tr
                %td
                  =permission.name
                %td
                  =check_box_tag @count, nil, nil, "permission_id-data" => permission.name, :class=>"add_permission #{permission.name}"
                -@count +=1 
:javascript
  
  $(".add_permission").click(function() {
    var permission_id = new Array();
    for (var i = 0; i < "#{@count}"; i++) {
      var checkBox = document.getElementById(i.toString());
      if(checkBox.checked){
        permission_id.push(checkBox.getAttribute("permission_id-data"));
      }
    }
    $("#permissions").val(permission_id.toString());
  });
  
  $("#user_id").change(function() {
    var user_id = $(this).find("option:selected").val();
    if(user_id){}else{
      clearCheckBox();
      return;
    }
    $.get("/users/get_permission_selected",{user_id: user_id}).done(function(data){
      clearCheckBox();
      if(data){
        datos = data.split(",");
        for (var i = 0; i < "#{@count}"; i++) {
          var checkBox = document.getElementById(i.toString());
          if(datos.indexOf(checkBox.getAttribute("permission_id-data")) >= 0){
            checkBox.checked = true;
          }else{
            checkBox.checked = false;
          }
        }
      }
      $.uniform.update();
    });
  });
  function clearCheckBox(){
    for (var i = 0; i < "#{@count}"; i++) {
      document.getElementById(i.toString()).checked = false;
    }
    $.uniform.update();
  }
