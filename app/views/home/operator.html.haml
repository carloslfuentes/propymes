.wrapper.top
  .grid_6.first
    .grid_6.first
      .panel.padding1
        %button.button.background_green.white#startButton{:style => "width:195px; height:55px;"}
          %h2
            = t :start
        %button.button.background_gray.white#standbyButton{:style => "width:195px; height:55px;", :disabled => true}
          %h2
            = t :standby
          //Chronometer
        %h0.top.float_right
          #chronometer.gray
        .clear
        //Add Items
        %hr.top
        .padding2
        #add_items.padding3
          .background_gray_clear
            .padding2
              = link_to image_tag("/images/d02/icons/addItem.png", :width => "64px", :style => "opacity:0.2; margin:0 0 0 66px;"), "#", :id=>"addItem", :action => "addItem"
              = link_to image_tag("/images/d02/icons/removeItem.png", :width => "64px", :style => "opacity:0.2; margin:0 0 0 57px;"), "#", :id=>"removeItem", :action => "removeItem"
              %h0.gray.top.float_right
                .numberPiece.top
                  = @working_day.number_piece.to_i.to_s
          .clear
    //Chart 
    .grid_6.panel.first.top.background_gray_clear
      .chart#rate_graph
  
  .grid_2
    .panel.padding1.gray
      //Work Times
      %h3
        = PConfig::WorkTime.model_name.human(:count => :other)
      %table.full.not-style
        %tr
          %td
            = PConfig::WorkTime.model_name.human(:count => 1)
          %td.bold.ar
            = PConfig::WorkTime.total_hours.utc.strftime "%H:%M"
        %tr
          %td
            = t :available_time
          %td.ar
            = @working_day.disponible_time.present? ? (@working_day.disponible_time.utc.strftime "%H:%M") : "00:00" 
        %tr
          %td
            = t :effective_time
          %td.ar
            = @working_day.effective_time.present? ? (@working_day.effective_time.utc.strftime "%H:%M") : "00:00"
      //Progress Production
      -@working_days.each do |working_day|
        %hr/
        .top
          %h3
            = t :production
          %progress{:value => working_day.nullo.number_piece.if_nil(0), :max => working_day.standard.nullo.item_number.if_nil(1), :id => "progress_graph"}
          .numberPiece.al.float_left
            = working_day.nullo.number_piece.to_i.if_nil(0)
          .ar
            = working_day.standard.nullo.item_number.if_nil(0)
      //Events
      %hr/
      .top
        %h3
          = PConfig::Event.model_name.human(:count => :other)
        %table.full.not-style
          - @station.events.each do |event|
            %tr.background_gray_clear
              %td.ac
                %h6
                  = event.stoppage_by_category.name
                .ac.not_bold
                  = event.stoppage.name
      //Stop
      %hr/
      .padding3.top.ac
        %a.button.background_red.white#stopButton{:style => "width:120px; height:40px;", :onclick => "$('#chronometer').chronometer({action:'stop', working_day_id:'#{@working_day.id}'});"}
          %h2
            = t :stop
//Validate Working Day
#validate_status.widget.panel.padding3.background_gray_clear{:style => "height:70px;"}
  .content
    .form
      .clearfix
        = label_tag PConfig::Product.model_name.human(:count => :other)
        = select_tag :product_id, options_for_select(PConfig::Product.for_station(request.ip).map{|prod| [prod.name, prod.id]})
      %hr/
      .ar.top
        %button.button.background_green.white{:href => "#", :id => "changeProduct"}
          = t :add
        - if @working_day.product_id.present?
          %a.button.background_gray.gray{:href => "#", :onclick => "$().closeModal();"}
            = t :cancel

:javascript
  $(document).ready(function() {
    //Validate Working Day
    $("#validate_status").validateStatus("#{@working_day.id}");
    
    //Start Chronometer
    $("#startButton").live("click", function(){
      $('#chronometer').chronometer({action:'start', hours:'#{@working_day.effective_time.hour}', minutes:'#{@working_day.effective_time.min}', seconds:'#{@working_day.effective_time.sec}', working_day_id:'#{@working_day.id}'});
      this.setAttribute('class','button background_gray white');
      this.setAttribute('disabled',true);
      //StandBy Button
      standbyButton = $("#standbyButton");
      standbyButton.attr('class','button background_yellow white');
      standbyButton.removeAttr('disabled');
      //We Enable Buttons
      $("#addItem, #removeItem").find("img").css("opacity", 1);
    });
    
    //StandBy Chronometer
    $("#standbyButton").live("click", function(){
      $('#chronometer').chronometer({action:'standby', working_day_id:'#{@working_day.id}'});
      this.setAttribute('class','button background_gray white');
      this.setAttribute('disabled',true);
      //Start Button
      startButton = $("#startButton");
      startButton.attr('class','button background_green white');
      startButton.removeAttr('disabled');
      //We Enable Buttons
      $("#addItem, #removeItem").find("img").css("opacity", 0.2);
    });
    
    //Chart Rate Graph
    $("#rate_graph").Chart(#{@rate_graph.to_json}, {type:"LineChart", tooltips:false, showLegend:false, formatX:'%X'},{ top:20, right:30, bottom:20, left:30 });
    
    //Change Product
    $("#changeProduct").live("click", function(){
      $.get("/home/change_product",{ product_id:$("#product_id").val(), working_day_id:#{@working_day.id} }).done(function(data){
        if(data){
          //Mandar Mensaje de Producto Cambiado
          $(this).closeModal();
        }
        
      });
    });
    
    //Add Items
    $('#addItem, #removeItem').live("click", function() {
      action = $(this).attr("action");
      number_piece = action == "addItem" ? 1 : -1
      $.post("/home/add_items",{number_piece:number_piece, time:$('#chronometer').text(),working_day_id:#{@working_day.id}}).done(function(data){
        //Number Piece
        $(".numberPiece").html(data["number_piece"]);
        
        //Progress Graph
        $("#progress_graph").val(data["number_piece"]);
        
        //Rate Graph
        graph = $("#rate_graph").html("");
        graph.Chart(eval(data["rate_graph"]), {type:"LineChart", tooltips:false, showLegend:false, formatX:'%X'},{ top:20, right:30, bottom:20, left:30 });
      });
    });
    
  });
